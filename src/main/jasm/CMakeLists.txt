# Stefano Belli
# --> src/main/jasm/CMakeLists.txt
cmake_minimum_required(VERSION 2.8.12) #CMake 2.8

project(JASM C) #JASM

#versioning
#Versioning & Build Date

#PATTERN : MAJOR.MINOR.REVISION:PATCH
set(JASM_VMAJOR 0)
set(JASM_VMINOR 0)
set(JASM_VREV 0)
set(JASM_VPATCH 0)
set(JASM_VERSION "${JASM_VMAJOR}.${JASM_VMINOR}.${JASM_VREV}:${JASM_VPATCH}")
#if(${CMAKE_BUILD_TYPE})
#    set(JASM_VERSION "${JASM_VMAJOR}.${JASM_VMINOR}.${JASM_VREV}:${JASM_VPATCH}-debug")
#endif()
configure_file (
    "core/jasmbuild_info.h.in"
    "core/jasmbuild_info.h"
    )

find_package(Threads REQUIRED) 
if(UNIX)
	if(THREADS_HAVE_PTHREAD_ARG)
		set(CMAKE_THREAD_LIBS_INIT "-pthread")
		target_compile_options(PUBLIC jasm "-pthread")
	endif()
endif()

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -O2 -pipe -mtune=native -std=c11 -Wall")
set(CMAKE_C_FLAGS_DEBUG "-DDEBUG -g -mtune=native -std=c11 -Wall -W")

set(CORESRCS core/configfile.c core/getter.c core/ipc.c core/logger.c 
 core/miscellaneous.c core/modules.c core/modules_list.c core/signals.c)
set(MODSRCS modules/module_logsender.c)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY_DEBUG  ../../../bin-debug)
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ../../../bin)

#timedate definition
add_definitions(-D_XOPEN_SOURCE=700)

add_library(jasmcore STATIC ${CORESRCS})#libjasmcore.a (linked to the executable )
add_library(jasmmodules STATIC ${MODSRCS})#libjasmmodules.a (linked to the executable)
add_executable(jasm core/jasm.c) 

target_link_libraries(jasm jasmcore jasmmodules ${CMAKE_THREAD_LIBS_INIT})
